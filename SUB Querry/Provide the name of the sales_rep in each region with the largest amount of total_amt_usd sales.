SELECT sr.name Sale_rep, r.name, SUM(o.total_amt_usd) AS sum_of_sales
FROM accounts a
JOIN orders o ON a.id = o.account_id
JOIN sales_reps sr ON a.sales_rep_id = sr.id
JOIN region r ON sr.region_id = r.id
GROUP BY sr.name, r.name
HAVING SUM(o.total_amt_usd) = (
    SELECT MAX(total_sales)
    FROM (
        SELECT sr.name AS sales_rep, r.name AS region_name, SUM(o.total_amt_usd) AS total_sales
        FROM accounts a
        JOIN orders o ON a.id = o.account_id
        JOIN sales_reps sr ON a.sales_rep_id = sr.id
        JOIN region r ON sr.region_id = r.id
        GROUP BY sr.name, r.name
    ) subquery
    WHERE subquery.region_name = r.name
)
